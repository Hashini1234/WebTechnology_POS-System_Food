<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Food POS - SPA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { background: #f8f9fa; }
        .nav-link.active { background-color: #0d6efd !important; color: white !important; }
        .page-section { display: none; }
        .table-sm td, .table-sm th { vertical-align: middle; }
    </style>
</head>
<body>

<!-- ===== Navbar ===== -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">üçî Food POS</a>
        <div>
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" href="#" data-page="itemsPage">Items</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-page="customersPage">Customers</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-page="ordersPage">Orders</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container py-4">

    <!-- ===== Items Page ===== -->
    <div id="itemsPage" class="page-section">
        <div class="d-flex justify-content-between mb-3">
            <h4>üçï Menu Items</h4>
            <button class="btn btn-primary btn-sm" id="addItemBtn">+ Add Item</button>
        </div>
        <table class="table table-bordered table-sm">
            <thead class="table-light">
            <tr><th>Name</th><th>Price</th><th>Stock</th><th>Category</th><th>Action</th></tr>
            </thead>
            <tbody id="itemsTableBody"></tbody>
        </table>
    </div>

    <!-- ===== Customers Page ===== -->
    <div id="customersPage" class="page-section">
        <div class="d-flex justify-content-between mb-3">
            <h4>üë• Customers</h4>
            <button class="btn btn-primary btn-sm" id="addCustomerBtn">+ Add Customer</button>
        </div>
        <table class="table table-bordered table-sm">
            <thead class="table-light">
            <tr><th>Name</th><th>Email</th><th>Phone</th><th>Action</th></tr>
            </thead>
            <tbody id="customersTableBody"></tbody>
        </table>
    </div>

    <!-- ===== Orders Page ===== -->
    <div id="ordersPage" class="page-section">
        <div class="d-flex justify-content-between mb-3">
            <h4>üßæ Orders</h4>
            <button class="btn btn-success btn-sm" id="newOrderBtn">+ New Order</button>
        </div>
        <table class="table table-bordered table-sm">
            <thead class="table-light">
            <tr><th>#</th><th>Date</th><th>Customer</th><th>Total</th><th>Action</th></tr>
            </thead>
            <tbody id="ordersTableBody"></tbody>
        </table>
    </div>

</div>

<!-- ===== Modals ===== -->

<!-- Item Modal -->
<div class="modal fade" id="itemModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Add Item</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <input type="hidden" id="itemId">
                <div class="mb-2"><label>Name</label><input class="form-control" id="itemName"></div>
                <div class="mb-2"><label>Price</label><input type="number" class="form-control" id="itemPrice"></div>
                <div class="mb-2"><label>Stock</label><input type="number" class="form-control" id="itemStock"></div>
                <div class="mb-2"><label>Category</label><input class="form-control" id="itemCategory"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveItem">Save</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Customer Modal -->
<div class="modal fade" id="customerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Add Customer</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <input type="hidden" id="customerId">
                <div class="mb-2"><label>Name</label><input class="form-control" id="customerName"></div>
                <div class="mb-2"><label>Email</label><input class="form-control" id="customerEmail"></div>
                <div class="mb-2"><label>Phone</label><input class="form-control" id="customerPhone"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveCustomer">Save</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(function() {

        // ====== LocalStorage Keys ======
        const LS_ITEMS = "foodpos_items";
        const LS_CUSTOMERS = "foodpos_customers";
        const LS_ORDERS = "foodpos_orders";

        let items = JSON.parse(localStorage.getItem(LS_ITEMS) || "[]");
        let customers = JSON.parse(localStorage.getItem(LS_CUSTOMERS) || "[]");
        let orders = JSON.parse(localStorage.getItem(LS_ORDERS) || "[]");

        // ====== Page Navigation ======
        function showPage(pageId) {
            $(".page-section").hide();
            $("#" + pageId).show();
            $(".nav-link").removeClass("active");
            $(`[data-page='${pageId}']`).addClass("active");
        }
        showPage("itemsPage");

        $(".nav-link").click(function() {
            const page = $(this).data("page");
            showPage(page);
        });

        // ====== Render Tables ======
        function renderItems() {
            const body = $("#itemsTableBody").empty();
            items.forEach((i, idx) => {
                body.append(`<tr>
        <td>${i.name}</td><td>${i.price}</td><td>${i.stock}</td><td>${i.category||''}</td>
        <td><button class='btn btn-sm btn-outline-secondary editItem' data-id='${i.id}'>Edit</button>
        <button class='btn btn-sm btn-outline-danger delItem' data-id='${i.id}'>Del</button></td></tr>`);
            });
        }

        function renderCustomers() {
            const body = $("#customersTableBody").empty();
            customers.forEach((c, idx) => {
                body.append(`<tr>
        <td>${c.name}</td><td>${c.email}</td><td>${c.phone}</td>
        <td><button class='btn btn-sm btn-outline-secondary editCustomer' data-id='${c.id}'>Edit</button>
        <button class='btn btn-sm btn-outline-danger delCustomer' data-id='${c.id}'>Del</button></td></tr>`);
            });
        }

        function renderOrders() {
            const body = $("#ordersTableBody").empty();
            orders.forEach((o, idx) => {
                body.append(`<tr><td>${idx+1}</td><td>${new Date(o.date).toLocaleString()}</td>
        <td>${o.customer}</td><td>${o.total}</td>
        <td><button class='btn btn-sm btn-outline-info viewOrder' data-id='${o.id}'>View</button></td></tr>`);
            });
        }

        renderItems(); renderCustomers(); renderOrders();

        // ====== Add Item ======
        $("#addItemBtn").click(() => {
            $("#itemId").val('');
            $("#itemName,#itemPrice,#itemStock,#itemCategory").val('');
            new bootstrap.Modal($("#itemModal")).show();
        });

        $("#saveItem").click(() => {
            const id = $("#itemId").val() || Date.now();
            const obj = {
                id,
                name: $("#itemName").val(),
                price: $("#itemPrice").val(),
                stock: $("#itemStock").val(),
                category: $("#itemCategory").val()
            };
            const existing = items.find(i => i.id == id);
            if(existing) Object.assign(existing, obj); else items.push(obj);
            localStorage.setItem(LS_ITEMS, JSON.stringify(items));
            renderItems();
            bootstrap.Modal.getInstance($("#itemModal")).hide();
        });

        // ====== Edit/Delete Item ======
        $("#itemsTableBody").on("click", ".editItem", function() {
            const id = $(this).data("id");
            const it = items.find(i => i.id == id);
            if(!it) return;
            $("#itemId").val(it.id);
            $("#itemName").val(it.name);
            $("#itemPrice").val(it.price);
            $("#itemStock").val(it.stock);
            $("#itemCategory").val(it.category);
            new bootstrap.Modal($("#itemModal")).show();
        });

        $("#itemsTableBody").on("click", ".delItem", function() {
            if(confirm("Delete this item?")) {
                const id = $(this).data("id");
                items = items.filter(i => i.id != id);
                localStorage.setItem(LS_ITEMS, JSON.stringify(items));
                renderItems();
            }
        });

        // ====== Add Customer ======
        $("#addCustomerBtn").click(() => {
            $("#customerId").val('');
            $("#customerName,#customerEmail,#customerPhone").val('');
            new bootstrap.Modal($("#customerModal")).show();
        });

        $("#saveCustomer").click(() => {
            const id = $("#customerId").val() || Date.now();
            const obj = {
                id,
                name: $("#customerName").val(),
                email: $("#customerEmail").val(),
                phone: $("#customerPhone").val()
            };
            const existing = customers.find(c => c.id == id);
            if(existing) Object.assign(existing, obj); else customers.push(obj);
            localStorage.setItem(LS_CUSTOMERS, JSON.stringify(customers));
            renderCustomers();
            bootstrap.Modal.getInstance($("#customerModal")).hide();
        });

        $("#customersTableBody").on("click", ".editCustomer", function() {
            const id = $(this).data("id");
            const c = customers.find(x => x.id == id);
            if(!c) return;
            $("#customerId").val(c.id);
            $("#customerName").val(c.name);
            $("#customerEmail").val(c.email);
            $("#customerPhone").val(c.phone);
            new bootstrap.Modal($("#customerModal")).show();
        });

        $("#customersTableBody").on("click", ".delCustomer", function() {
            if(confirm("Delete this customer?")) {
                const id = $(this).data("id");
                customers = customers.filter(c => c.id != id);
                localStorage.setItem(LS_CUSTOMERS, JSON.stringify(customers));
                renderCustomers();
            }
        });

        // ====== Orders (Demo Only) ======
        $("#newOrderBtn").click(() => {
            const cust = customers.length ? customers[Math.floor(Math.random()*customers.length)].name : "Walk-in";
            const total = (Math.random()*100+10).toFixed(2);
            const order = { id: Date.now(), date: new Date().toISOString(), customer: cust, total };
            orders.unshift(order);
            localStorage.setItem(LS_ORDERS, JSON.stringify(orders));
            renderOrders();
        });

        $("#ordersTableBody").on("click", ".viewOrder", function() {
            const id = $(this).data("id");
            const o = orders.find(x => x.id == id);
            if(!o) return;
            alert(`Order ID: ${o.id}\nCustomer: ${o.customer}\nTotal: ${o.total}\nDate: ${new Date(o.date).toLocaleString()}`);
        });

    });
</script>
</body>
</html>
