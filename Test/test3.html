<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Food POS ‚Äî Stylish SPA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{ --accent:#0d6efd; --muted:#6c757d; }
        body{ font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background: linear-gradient(180deg,#f7fafc, #eef2ff 60%); min-height:100vh; }
        .app-shell{ max-width:1200px; margin:28px auto; }
        .sidebar { background: white; border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(13,110,253,0.06);}
        .brand { font-weight:700; color:var(--accent); }
        .nav-pill .nav-link{ border-radius:8px; color:#334155; }
        .nav-pill .nav-link.active{ background: linear-gradient(90deg, rgba(13,110,253,0.12), rgba(13,110,253,0.06)); color:var(--accent); font-weight:600; }
        .card-ghost{ background:rgba(255,255,255,0.8); border:none; box-shadow: 0 8px 24px rgba(15,23,42,0.06); }
        .page{ display:none; }
        .page.active{ display:block; }
        .table-sm td, .table-sm th{ vertical-align:middle; }
        .muted { color:var(--muted); font-size:0.9rem; }
        .badge-pill { border-radius:999px; }
        .footer-note{ font-size:0.85rem; color:#94a3b8; }
        @media (max-width: 767px){ .app-shell{ padding:12px } }
    </style>
</head>
<body>
<div class="app-shell container">
    <div class="row g-3">
        <!-- LEFT: Sidebar -->
        <div class="col-12 col-md-4 col-lg-3">
            <div class="sidebar p-3">
                <div class="d-flex align-items-center mb-3">
                    <div class="me-2 display-6">üçΩÔ∏è</div>
                    <div>
                        <div class="brand h5 mb-0">Food POS</div>
                        <div class="muted">Simple ‚Ä¢ Beautiful ‚Ä¢ Local</div>
                    </div>
                </div>

                <ul class="nav nav-pills flex-column nav-pills-gap nav-pill" id="mainNav">
                    <li class="nav-item mb-1"><a class="nav-link active" data-page="page-items"><i class="bi bi-box-seam me-2"></i>Items</a></li>
                    <li class="nav-item mb-1"><a class="nav-link" data-page="page-customers"><i class="bi bi-people me-2"></i>Customers</a></li>
                    <li class="nav-item mb-1"><a class="nav-link" data-page="page-orders"><i class="bi bi-receipt me-2"></i>Orders</a></li>
                    <li class="nav-item mb-1"><a class="nav-link" data-page="page-pos"><i class="bi bi-cart me-2"></i>POS (Checkout)</a></li>
                </ul>

                <hr />
                <div class="mb-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="muted">Inventory</small>
                        <span id="countItems" class="badge bg-light text-dark badge-pill">0</span>
                    </div>
                </div>

                <div class="mt-3">
                    <button id="btnLoadSample" class="btn btn-sm btn-outline-primary w-100 mb-2"><i class="bi bi-download me-1"></i>Load Sample Data</button>
                    <button id="btnClearAll" class="btn btn-sm btn-outline-danger w-100"><i class="bi bi-trash me-1"></i>Clear All Data</button>
                </div>

                <div class="mt-4 footer-note">Tip: App uses <strong>localStorage</strong>. Works offline in the browser ‚Äî safe for quick demos.</div>
            </div>
        </div>

        <!-- RIGHT: Content -->
        <div class="col-12 col-md-8 col-lg-9">
            <div class="card card-ghost p-3">
                <!-- Items Page -->
                <div id="page-items" class="page active">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h4 class="mb-0">Menu Items</h4>
                            <div class="muted">Manage menu and stock</div>
                        </div>
                        <div class="d-flex gap-2">
                            <input id="searchItem" class="form-control form-control-sm" placeholder="Search items..." style="min-width:220px;">
                            <button class="btn btn-primary btn-sm" id="openAddItem"><i class="bi bi-plus-lg"></i> Add</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm align-middle">
                            <thead><tr class="text-muted"><th>Name</th><th>Category</th><th class="text-end">Price</th><th class="text-end">Stock</th><th></th></tr></thead>
                            <tbody id="tblItems"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Customers Page -->
                <div id="page-customers" class="page">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h4 class="mb-0">Customers</h4>
                            <div class="muted">Add or edit customer records</div>
                        </div>
                        <div>
                            <button class="btn btn-primary btn-sm" id="openAddCustomer"><i class="bi bi-person-plus"></i> New Customer</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm align-middle">
                            <thead><tr class="text-muted"><th>Name</th><th>Email</th><th>Phone</th><th></th></tr></thead>
                            <tbody id="tblCustomers"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Orders Page -->
                <div id="page-orders" class="page">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h4 class="mb-0">Orders</h4>
                            <div class="muted">All placed orders</div>
                        </div>
                        <div>
                            <button class="btn btn-success btn-sm" id="openPOSFromOrders"><i class="bi bi-cart-check"></i> Open POS</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm align-middle">
                            <thead><tr class="text-muted"><th>#</th><th>Date</th><th>Customer</th><th class="text-end">Total</th><th></th></tr></thead>
                            <tbody id="tblOrders"></tbody>
                        </table>
                    </div>
                </div>

                <!-- POS Page -->
                <div id="page-pos" class="page">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h4 class="mb-0">Point of Sale</h4>
                            <div class="muted">Create order, apply tax/discount and checkout</div>
                        </div>
                        <div class="d-flex gap-2">
                            <select id="posCustomer" class="form-select form-select-sm" style="min-width:180px;"></select>
                            <button class="btn btn-outline-secondary btn-sm" id="openAddCustomerQuick">+ Cust</button>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-lg-7">
                            <div class="card p-2 mb-3">
                                <div class="d-flex gap-2 mb-2">
                                    <select id="posItemSelect" class="form-select form-select-sm"></select>
                                    <input id="posQty" type="number" class="form-control form-control-sm" value="1" min="1" style="width:90px;">
                                    <button class="btn btn-primary btn-sm" id="posAddItem">Add</button>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-sm mb-0">
                                        <thead><tr class="text-muted"><th>Item</th><th class="text-end">Price</th><th class="text-end">Qty</th><th class="text-end">Total</th><th></th></tr></thead>
                                        <tbody id="posCartBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-5">
                            <div class="card p-3">
                                <div class="mb-2 d-flex justify-content-between"><small class="muted">Subtotal</small><strong id="posSubtotal">0.00</strong></div>
                                <div class="mb-2 d-flex justify-content-between align-items-center">
                                    <div><small class="muted">Discount %</small><input id="posDiscount" type="number" class="form-control form-control-sm mt-1" value="0" min="0" max="100"></div>
                                </div>
                                <div class="mb-2 d-flex justify-content-between"><small class="muted">Tax %</small><strong id="posTax">8</strong></div>

                                <hr />
                                <div class="d-flex justify-content-between align-items-center mb-2"><div class="muted">Total</div><h4 id="posTotal">0.00</h4></div>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" id="btnCheckout">Checkout</button>
                                    <button class="btn btn-outline-danger" id="btnClearPos">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- Modals: Item, Customer, Order View -->
<div class="modal fade" id="modalItem" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Item</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
        <input type="hidden" id="mItemId">
        <div class="mb-2"><label class="form-label">Name</label><input id="mItemName" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Category</label><input id="mItemCat" class="form-control"></div>
        <div class="row g-2"><div class="col-6"><label class="form-label">Price</label><input id="mItemPrice" type="number" class="form-control"></div>
            <div class="col-6"><label class="form-label">Stock</label><input id="mItemStock" type="number" class="form-control"></div></div>
    </div>
    <div class="modal-footer"><button class="btn btn-primary" id="saveItemBtn">Save</button><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
</div></div></div>

<div class="modal fade" id="modalCustomer" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Customer</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
        <input type="hidden" id="mCustId">
        <div class="mb-2"><label class="form-label">Name</label><input id="mCustName" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Email</label><input id="mCustEmail" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Phone</label><input id="mCustPhone" class="form-control"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-primary" id="saveCustBtn">Save</button><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
</div></div></div>

<div class="modal fade" id="modalOrderView" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Order</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="orderViewBody"></div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
</div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ----- LocalStorage keys -----
    const LS_MENU = 'spa_pos_menu_v2';
    const LS_CUSTOMERS = 'spa_pos_customers_v2';
    const LS_ORDERS = 'spa_pos_orders_v2';

    let menu = JSON.parse(localStorage.getItem(LS_MENU) || '[]');
    let customers = JSON.parse(localStorage.getItem(LS_CUSTOMERS) || '[]');
    let orders = JSON.parse(localStorage.getItem(LS_ORDERS) || '[]');
    let posCart = [];

    // ----- Helpers -----
    const fmt = n => Number(n).toFixed(2);
    const uid = ()=> 'id'+Date.now()+Math.floor(Math.random()*999);

    // ----- Navigation -----
    document.querySelectorAll('#mainNav .nav-link').forEach(a=> a.addEventListener('click', e=>{
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('#mainNav .nav-link').forEach(l=>l.classList.remove('active'));
        a.classList.add('active');
        const page = a.getAttribute('data-page');
        document.getElementById(page).classList.add('active');
        if(page === 'page-pos') refreshPOS();
    }));

    // ----- Render Functions -----
    function renderCounts(){ document.getElementById('countItems').innerText = menu.length; }

    function renderItems(filter=''){
        const tbody = document.getElementById('tblItems'); tbody.innerHTML='';
        const q = filter.trim().toLowerCase();
        menu.filter(it => it.name.toLowerCase().includes(q) || (it.category||'').toLowerCase().includes(q)).forEach(it=>{
            const row = document.createElement('tr');
            row.innerHTML = `
      <td><strong>${it.name}</strong><div class="muted small">${it.id}</div></td>
      <td>${it.category||''}</td>
      <td class="text-end">${fmt(it.price)}</td>
      <td class="text-end">${it.stock}</td>
      <td class="text-end">
        <button class="btn btn-sm btn-outline-secondary me-1 edit-item" data-id="${it.id}"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-sm btn-outline-danger del-item" data-id="${it.id}"><i class="bi bi-trash"></i></button>
      </td>`;
            tbody.appendChild(row);
        });
    }

    function renderCustomers(){ const tbody = document.getElementById('tblCustomers'); tbody.innerHTML='';
        customers.forEach(c=>{ const r = document.createElement('tr'); r.innerHTML = `
    <td><strong>${c.name}</strong></td><td>${c.email||''}</td><td>${c.phone||''}</td>
    <td class="text-end">
      <button class="btn btn-sm btn-outline-secondary me-1 edit-cust" data-id="${c.id}"><i class="bi bi-pencil"></i></button>
      <button class="btn btn-sm btn-outline-danger del-cust" data-id="${c.id}"><i class="bi bi-trash"></i></button>
    </td>`; tbody.appendChild(r); });
    }

    function renderOrders(){ const tbody = document.getElementById('tblOrders'); tbody.innerHTML='';
        orders.forEach((o, idx)=>{ const r = document.createElement('tr'); r.innerHTML = `
    <td>${idx+1}</td>
    <td>${new Date(o.date).toLocaleString()}</td>
    <td>${o.customer}</td>
    <td class="text-end">${fmt(o.total)}</td>
    <td class="text-end"><button class="btn btn-sm btn-outline-info view-order" data-id="${o.id}"><i class="bi bi-eye"></i></button></td>`; tbody.appendChild(r); });
    }

    // ----- CRUD: Items -----
    function openItemModal(it=null){ document.getElementById('mItemId').value = it? it.id : '';
        document.getElementById('mItemName').value = it? it.name : '';
        document.getElementById('mItemCat').value = it? it.category : '';
        document.getElementById('mItemPrice').value = it? it.price : '';
        document.getElementById('mItemStock').value = it? it.stock : 0;
        new bootstrap.Modal(document.getElementById('modalItem')).show(); }

    function saveItemFromModal(){ const id = document.getElementById('mItemId').value || uid();
        const obj = { id, name: document.getElementById('mItemName').value.trim(), category: document.getElementById('mItemCat').value.trim(), price: Number(document.getElementById('mItemPrice').value||0), stock: Number(document.getElementById('mItemStock').value||0) };
        const ex = menu.find(x=>x.id==id);
        if(ex) Object.assign(ex,obj); else menu.push(obj);
        localStorage.setItem(LS_MENU, JSON.stringify(menu)); renderItems(); renderCounts(); updatePOSSelects(); bootstrap.Modal.getInstance(document.getElementById('modalItem')).hide(); }

    // ----- CRUD: Customers -----
    function openCustomerModal(c=null){ document.getElementById('mCustId').value = c? c.id : '';
        document.getElementById('mCustName').value = c? c.name : '';
        document.getElementById('mCustEmail').value = c? c.email : '';
        document.getElementById('mCustPhone').value = c? c.phone : '';
        new bootstrap.Modal(document.getElementById('modalCustomer')).show(); }

    function saveCustomerFromModal(){ const id = document.getElementById('mCustId').value || uid();
        const obj = { id, name: document.getElementById('mCustName').value.trim(), email: document.getElementById('mCustEmail').value.trim(), phone: document.getElementById('mCustPhone').value.trim() };
        const ex = customers.find(x=>x.id==id);
        if(ex) Object.assign(ex,obj); else customers.push(obj);
        localStorage.setItem(LS_CUSTOMERS, JSON.stringify(customers)); renderCustomers(); updatePOSSelects(); bootstrap.Modal.getInstance(document.getElementById('modalCustomer')).hide(); }

    // ----- POS: cart handling -----
    function updatePOSCartView(){ const tbody = document.getElementById('posCartBody'); tbody.innerHTML='';
        let subtotal = 0; posCart.forEach((c,idx)=>{ subtotal += c.price*c.qty; const tr = document.createElement('tr'); tr.innerHTML = `
    <td>${c.name}</td><td class="text-end">${fmt(c.price)}</td><td class="text-end">${c.qty}</td><td class="text-end">${fmt(c.price*c.qty)}</td>
    <td class="text-end"><button class="btn btn-sm btn-outline-danger remove-pos" data-idx="${idx}"><i class="bi bi-x"></i></button></td>`; tbody.appendChild(tr); });
        document.getElementById('posSubtotal').innerText = fmt(subtotal);
        const disc = Number(document.getElementById('posDiscount').value||0);
        const taxPercent = 8; // fixed for demo
        const discount = subtotal * (disc/100);
        const tax = (subtotal - discount) * (taxPercent/100);
        const total = subtotal - discount + tax;
        document.getElementById('posTotal').innerText = fmt(total);
    }

    function updatePOSSelects(){ const itemSel = document.getElementById('posItemSelect'); itemSel.innerHTML = menu.map(m=>`<option value="${m.id}">${m.name} ‚Äî ${fmt(m.price)}</option>`).join('');
        const custSel = document.getElementById('posCustomer'); custSel.innerHTML = '<option value="">Walk-in</option>' + customers.map(c=>`<option value="${c.id}">${c.name}</option>`).join(''); }

    function refreshPOS(){ updatePOSSelects(); updatePOSCartView(); }

    // ----- Events -----
    // Buttons open modals
    document.getElementById('openAddItem').addEventListener('click', ()=> openItemModal());
    document.getElementById('saveItemBtn').addEventListener('click', saveItemFromModal);

    document.getElementById('openAddCustomer').addEventListener('click', ()=> openCustomerModal());
    document.getElementById('saveCustBtn').addEventListener('click', saveCustomerFromModal);

    document.getElementById('openAddCustomerQuick').addEventListener('click', ()=> openCustomerModal());

    // Search items
    document.getElementById('searchItem').addEventListener('input', (e)=> renderItems(e.target.value));

    // Delegated actions: edit/delete items
    document.getElementById('tblItems').addEventListener('click', (e)=>{
        const ed = e.target.closest('.edit-item'); if(ed){ const id = ed.dataset.id; const it = menu.find(x=>x.id==id); if(it) openItemModal(it); return; }
        const del = e.target.closest('.del-item'); if(del){ if(confirm('Delete item?')){ const id = del.dataset.id; menu = menu.filter(x=>x.id!=id); localStorage.setItem(LS_MENU, JSON.stringify(menu)); renderItems(); renderCounts(); updatePOSSelects(); } return; }
    });

    // Delegated actions: edit/delete customers
    document.getElementById('tblCustomers').addEventListener('click', (e)=>{
        const ed = e.target.closest('.edit-cust'); if(ed){ const id = ed.dataset.id; const c = customers.find(x=>x.id==id); if(c) openCustomerModal(c); return; }
        const del = e.target.closest('.del-cust'); if(del){ if(confirm('Delete customer?')){ const id = del.dataset.id; customers = customers.filter(x=>x.id!=id); localStorage.setItem(LS_CUSTOMERS, JSON.stringify(customers)); renderCustomers(); updatePOSSelects(); } return; }
    });

    // Orders view
    document.getElementById('tblOrders').addEventListener('click', (e)=>{
        const v = e.target.closest('.view-order'); if(v){ const id = v.dataset.id; const o = orders.find(x=>x.id==id); if(!o) return; const body = document.getElementById('orderViewBody'); body.innerHTML = `<pre>${JSON.stringify(o, null, 2)}</pre>`; new bootstrap.Modal(document.getElementById('modalOrderView')).show(); }
    });

    // POS actions
    document.getElementById('posAddItem').addEventListener('click', ()=>{
        const id = document.getElementById('posItemSelect').value; const qty = Number(document.getElementById('posQty').value||1);
        const it = menu.find(x=>x.id==id); if(!it) return alert('Item not found'); if(it.stock < qty) return alert('Not enough stock');
        const existing = posCart.find(x=>x.id==id); if(existing) existing.qty += qty; else posCart.push({ id: it.id, name: it.name, price: Number(it.price), qty });
        updatePOSCartView();
    });

    document.getElementById('posCartBody').addEventListener('click', (e)=>{ const btn = e.target.closest('.remove-pos'); if(btn){ const idx = Number(btn.dataset.idx); posCart.splice(idx,1); updatePOSCartView(); } });

    document.getElementById('btnClearPos').addEventListener('click', ()=>{ if(confirm('Clear cart?')){ posCart = []; updatePOSCartView(); } });

    document.getElementById('btnCheckout').addEventListener('click', ()=>{
        if(posCart.length===0) return alert('Cart empty');
        const custId = document.getElementById('posCustomer').value; const custName = custId? (customers.find(c=>c.id==custId)||{}).name : 'Walk-in';
        let subtotal = posCart.reduce((s,i)=>s + i.price*i.qty, 0);
        const disc = Number(document.getElementById('posDiscount').value||0);
        const discount = subtotal * (disc/100);
        const taxPercent = 8;
        const tax = (subtotal - discount) * (taxPercent/100);
        const total = subtotal - discount + tax;
        // deduct stock
        posCart.forEach(ci=>{ const it = menu.find(m=>m.id==ci.id); if(it) it.stock = Math.max(0, it.stock - ci.qty); });
        const order = { id: uid(), date: new Date().toISOString(), customer: custName, items: JSON.parse(JSON.stringify(posCart)), subtotal, discount, tax, total };
        orders.unshift(order); localStorage.setItem(LS_ORDERS, JSON.stringify(orders)); localStorage.setItem(LS_MENU, JSON.stringify(menu));
        posCart = []; renderItems(); renderOrders(); renderCounts(); updatePOSCartView(); alert('Order placed: '+order.id);
    });

    // Load sample and clear
    document.getElementById('btnLoadSample').addEventListener('click', ()=>{
        if(!confirm('Load sample data? This will overwrite current items.')) return;
        menu = [ {id:'I100', name:'Cheese Burger', category:'Burger', price:4.5, stock:20}, {id:'I101', name:'Veg Burger', category:'Burger', price:3.8, stock:15}, {id:'I102', name:'Chicken Wrap', category:'Wraps', price:5.0, stock:12}, {id:'I103', name:'French Fries', category:'Sides', price:2.5, stock:30}, {id:'I104', name:'Coke (330ml)', category:'Drinks', price:1.5, stock:40}, {id:'I105', name:'Ice Cream', category:'Dessert', price:2.0, stock:10} ];
        localStorage.setItem(LS_MENU, JSON.stringify(menu)); renderItems(); renderCounts(); updatePOSSelects();
    });

    document.getElementById('btnClearAll').addEventListener('click', ()=>{
        if(!confirm('Clear all data (items, customers, orders)?')) return; menu=[]; customers=[]; orders=[]; localStorage.removeItem(LS_MENU); localStorage.removeItem(LS_CUSTOMERS); localStorage.removeItem(LS_ORDERS); renderItems(); renderCustomers(); renderOrders(); renderCounts(); updatePOSSelects();
    });

    // Initial render
    renderItems(); renderCustomers(); renderOrders(); renderCounts(); updatePOSSelects();

</script>
</body>
</html>
